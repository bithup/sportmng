<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xgh.mng.dao.read.ISysUnitsDaoR">

	<resultMap type="com.xgh.mng.entity.SysUnits" id="sysUnitsMap">
		<result property="id" column="id" javaType="long" jdbcType="BIGINT" />
		<result property="nid" column="nid" javaType="long" jdbcType="BIGINT" />
		<result property="parentId" column="parent_id" javaType="long" jdbcType="BIGINT" />
		<result property="parentNid" column="parent_nid" javaType="long" jdbcType="BIGINT" />
		<result property="instId" column="inst_id" javaType="long" jdbcType="BIGINT" />
		<result property="instNid" column="inst_nid" javaType="long" jdbcType="BIGINT" />
		<result property="instCode" column="inst_code" javaType="string" jdbcType="VARCHAR" />
		<result property="unitCode" column="unit_code" javaType="string" jdbcType="VARCHAR" />
		<result property="unitType" column="unit_type" javaType="int" jdbcType="INTEGER" />
		<result property="unitKind" column="unit_kind" javaType="int" jdbcType="INTEGER" />
		<result property="zoneCode" column="zone_code" javaType="string" jdbcType="VARCHAR" />
		<result property="unitDomain" column="unit_domain" javaType="string" jdbcType="VARCHAR" />
		<result property="unitName" column="unit_name" javaType="string" jdbcType="VARCHAR" />
		<result property="shortName" column="short_name" javaType="string" jdbcType="VARCHAR" />
		<result property="regDate" column="reg_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="stopDate" column="stop_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="userCount" column="user_count" javaType="long" jdbcType="BIGINT" />
		<result property="unitStatus" column="unit_status" javaType="string" jdbcType="VARCHAR" />
		<result property="adminUrl" column="admin_url" javaType="string" jdbcType="VARCHAR" />
		<result property="portalUrl" column="portal_url" javaType="string" jdbcType="VARCHAR" />
		<result property="unitAddress" column="unit_address" javaType="string" jdbcType="VARCHAR" />
		<result property="telAreaCode" column="tel_area_code" javaType="string" jdbcType="VARCHAR" />
		<result property="tel" column="tel" javaType="string" jdbcType="VARCHAR" />
		<result property="telService" column="tel_service" javaType="string" jdbcType="VARCHAR" />
		<result property="fax" column="fax" javaType="string" jdbcType="VARCHAR" />
		<result property="legalPerson" column="legal_person" javaType="string" jdbcType="VARCHAR" />
		<result property="legalPersonMobile" column="legal_person_mobile" javaType="string" jdbcType="VARCHAR" />
		<result property="logoPath" column="logo_path" javaType="string" jdbcType="VARCHAR" />
		<result property="logoUrl" column="logo_url" javaType="string" jdbcType="VARCHAR" />
		<result property="version" column="version" javaType="int" jdbcType="INTEGER" />
		<result property="ord" column="ord" javaType="long" jdbcType="BIGINT" />
		<result property="createDate" column="create_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="updateDate" column="update_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="status" column="status" javaType="int" jdbcType="INTEGER" />
		<result property="remark" column="remark" javaType="string" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap type="java.util.Map" id="sysUnitsMap2">
		<result property="ID" column="id" javaType="long" jdbcType="BIGINT" />
		<result property="NID" column="nid" javaType="long" jdbcType="BIGINT" />
		<result property="PARENT_ID" column="parent_id" javaType="long" jdbcType="BIGINT" />
		<result property="PARENT_NID" column="parent_nid" javaType="long" jdbcType="BIGINT" />
		<result property="INST_ID" column="inst_id" javaType="long" jdbcType="BIGINT" />
		<result property="INST_NID" column="inst_nid" javaType="long" jdbcType="BIGINT" />
		<result property="INST_CODE" column="inst_code" javaType="string" jdbcType="VARCHAR" />
		<result property="UNIT_CODE" column="unit_code" javaType="string" jdbcType="VARCHAR" />
		<result property="UNIT_TYPE" column="unit_type" javaType="int" jdbcType="INTEGER" />
		<result property="UNIT_KIND" column="unit_kind" javaType="int" jdbcType="INTEGER" />
		<result property="ZONE_CODE" column="zone_code" javaType="string" jdbcType="VARCHAR" />
		<result property="UNIT_DOMAIN" column="unit_domain" javaType="string" jdbcType="VARCHAR" />
		<result property="UNIT_NAME" column="unit_name" javaType="string" jdbcType="VARCHAR" />
		<result property="SHORT_NAME" column="short_name" javaType="string" jdbcType="VARCHAR" />
		<result property="REG_DATE" column="reg_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="STOP_DATE" column="stop_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="USER_COUNT" column="user_count" javaType="long" jdbcType="BIGINT" />
		<result property="UNIT_STATUS" column="unit_status" javaType="string" jdbcType="VARCHAR" />
		<result property="ADMIN_URL" column="admin_url" javaType="string" jdbcType="VARCHAR" />
		<result property="PORTAL_URL" column="portal_url" javaType="string" jdbcType="VARCHAR" />
		<result property="UNIT_ADDRESS" column="unit_address" javaType="string" jdbcType="VARCHAR" />
		<result property="TEL_AREA_CODE" column="tel_area_code" javaType="string" jdbcType="VARCHAR" />
		<result property="TEL" column="tel" javaType="string" jdbcType="VARCHAR" />
		<result property="TEL_SERVICE" column="tel_service" javaType="string" jdbcType="VARCHAR" />
		<result property="FAX" column="fax" javaType="string" jdbcType="VARCHAR" />
		<result property="LEGAL_PERSON" column="legal_person" javaType="string" jdbcType="VARCHAR" />
		<result property="LEGAL_PERSON_MOBILE" column="legal_person_mobile" javaType="string" jdbcType="VARCHAR" />
		<result property="LOGO_PATH" column="logo_path" javaType="string" jdbcType="VARCHAR" />
		<result property="LOGO_URL" column="logo_url" javaType="string" jdbcType="VARCHAR" />
		<result property="VERSION" column="version" javaType="int" jdbcType="INTEGER" />
		<result property="ORD" column="ord" javaType="long" jdbcType="BIGINT" />
		<result property="CREATE_DATE" column="create_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="UPDATE_DATE" column="update_date" javaType="date" jdbcType="TIMESTAMP" />
		<result property="STATUS" column="status" javaType="int" jdbcType="INTEGER" />
		<result property="REMARK" column="remark" javaType="string" jdbcType="VARCHAR" />
	</resultMap>

	<select id="get" parameterType="long" resultMap="sysUnitsMap">
        select * from tb_sys_units where id = #{id}
    </select>

	<select id="getList" parameterType="com.xgh.mng.entity.SysUnits"
			resultMap="sysUnitsMap">
		select * from
		tb_sys_units
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="id!= null">
				and id = #{id}
			</if>
			<if test="instId!= null">
				and inst_id = #{instId}
			</if>
		</trim>
	</select>


	<select id="getListPage" parameterType="hashmap" resultMap="sysUnitsMap">
		select
		*
		from
		tb_sys_units
		<if test="keySysUnits!= null">
			<trim prefix="WHERE" prefixOverrides="AND |OR ">

				<if test="keySysUnits.id!= null">
					and id = #{keySysUnits.id}
				</if>
			</trim>
		</if>
		limit ${(page-1)*pagesize},${pagesize}
	</select>

	<select id="getRows" parameterType="hashmap" resultType="long">
		select
		count(*) from
		tb_sys_units
		<if test="keySysUnits!= null">
			<trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="keySysUnits.id!= null">
					and id = #{keySysUnits.id}
				</if>
			</trim>
		</if>
	</select>

	<!--<select id="getUnitTreeData" parameterType="hashmap" resultType="hashmap">-->
        <!--SELECT-->
        <!--id,-->
        <!--parent_id as pid,-->
        <!--unit_name as text-->
        <!--FROM-->
        <!--tb_sys_units-->
    <!--</select>-->

	<select id="getUnitTreeData" parameterType="hashmap" resultType="hashmap">
		SELECT
		id,
		parent_id as pid,
		unit_name as text,
		unit_type as unitType
		FROM
		tb_sys_units
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="1==1">
				AND inst_id = #{instId} AND status = 1
				AND (unit_type = 1 OR unit_type = 2 OR unit_type = 3)
			</if>
			<if test="parentId!=null and parentId!=''">
				AND parent_id = #{parentId}
			</if>
		</trim>
	</select>

	<!-- 省级代理审核旗舰店 -->
	<select id="getUnitTreeDataByProvinceId" parameterType="hashmap" resultType="hashmap">
		SELECT
		id,
		parent_id as pid,
		unit_name as text
		FROM
		tb_sys_units
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			(unit_status = 'register' or unit_status = 'recheck' or unit_status = 'rechange' or unit_status = 'unpass')
			AND (unit_type = 2 or unit_type=3)
			<if test="partentId!=null and partentId!=''">
				and parent_id = #{partentId}
			</if>
		</trim>
	</select>

	<select id="getUnitListMap" parameterType="hashmap" resultMap="sysUnitsMap">
		SELECT
		*
		FROM
		tb_sys_units
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			status = 1
			<if test="instId!=0">
				AND inst_id = #{instId} AND parent_id = #{parentId} AND unit_status = 'pass'
			</if>
			<if test="kindType!=null and kindType==1">
				AND parent_id = #{parentId} AND (unit_type = 1 OR unit_type = 2 OR unit_type = 3)
			</if>
			<if test="kindType!=null and kindType==2">
				AND (unit_type = 10 OR unit_type = 11 OR unit_type = 12)
			</if>
		</trim>
		limit ${(page-1)*pagesize},${pagesize}
	</select>

	<select id="getUnitListRows" parameterType="hashmap" resultType="long">
		SELECT
		count(*)
		FROM
		tb_sys_units
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			status = 1
			<if test="instId!=0">
				AND inst_id = #{instId} AND parent_id = #{parentId} AND unit_status = 'pass'
			</if>
			<if test="kindType!=null and kindType==1">
				AND parent_id = #{parentId} AND (unit_type = 1 OR unit_type = 2 OR unit_type = 3)
			</if>
			<if test="kindType!=null and kindType==2">
				AND (unit_type = 10 OR unit_type = 11 OR unit_type = 12)
			</if>
			<if test="configQuery!=null and configQuery!=''">
				AND ${configQuery}
			</if>
		</trim>
	</select>

	<select id="getUnCheckListMap" parameterType="hashmap" resultMap="sysUnitsMap">
		SELECT
		*
		FROM
		tb_sys_units
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			(unit_status = 'register' or unit_status = 'recheck' or unit_status = 'rechange' or unit_status = 'unpass') AND  status = 1
			<if test="instId!=0">
				AND inst_id = #{instId}
			</if>
			<if test="kindType!=null and kindType==1">
				AND (unit_type = 2 OR unit_type = 3)
			</if>
			<if test="kindType!=null and kindType==2">
				AND (unit_type = 10 OR unit_type = 11 OR unit_type = 12) AND parent_id = #{parentUnitId}
			</if>
		</trim>
		limit ${(page-1)*pagesize},${pagesize}
	</select>

	<select id="getUnCheckListRows" parameterType="hashmap" resultType="long">
		SELECT
		count(id)
		FROM
		tb_sys_units
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			(unit_status = 'register' or unit_status = 'recheck' or unit_status = 'rechange' or unit_status = 'unpass') AND status = 1
			<if test="instId!=0">
				AND inst_id = #{instId}
			</if>
			<if test="kindType!=null and kindType==1">
				AND (unit_type = 2 OR unit_type = 3)
			</if>
			<if test="kindType!=null and kindType==2">
				AND (unit_type = 10 OR unit_type = 11 OR unit_type = 12) AND parent_id = #{parentUnitId}
			</if>
		</trim>
	</select>

	<select id="getPassUnitList" parameterType="hashmap" resultMap="sysUnitsMap2">
        SELECT
        *
        FROM
        tb_sys_units
        where (unit_status = 'pass' AND stop_date &gt; now() AND status = 1) or id = 1
    </select>

	<select id="getChildZoneListByPcode" parameterType="hashmap" resultType="hashmap">
		SELECT
		id as id,
		code as code,
		name as name
		FROM
		tb_zone
		WHERE
		<choose>
			<when test="pcode!=null and pcode!=''">
				pcode = #{pcode}
			</when>
			<otherwise>
				level = 1
			</otherwise>
		</choose>
	</select>

	<select id="getChildZoneListByPid" parameterType="long" resultType="hashmap">
        SELECT
        id as id,
        code as code,
        name as name
        FROM
        tb_zone
        WHERE pid = #{pid}
    </select>

	<select id="getZonePrefixByCode" parameterType="string" resultType="string">
        SELECT
        pre_fix
        FROM
        tb_zone
        WHERE
        code = #{code}
        limit 0,1
    </select>

	<select id="getUnitRowsByZoneCode" parameterType="hashmap" resultType="long">
		SELECT
		count(id)
		FROM
		tb_sys_units
		WHERE
		zone_code = #{zoneCode}
		AND inst_id = #{instId}
		AND (unit_type = 2 or unit_type = 3)
		<if test="id !=null">
			and id &lt;&gt; #{id}
		</if>
	</select>

	<select id="getUnitRowsBySame" parameterType="hashmap" resultType="hashmap">
		SELECT
		*
		FROM
		tb_sys_units
		WHERE 1=1
		<if test="unitDomain !=null and unitDomain!=''">
			and unit_domain = #{unitDomain}
		</if>
		<if test="id !=null and id!=''">
			and id &lt;&gt; #{id}
		</if>
		<if test="unitName !=null and unitName!=''">
			and unit_name = #{unitName}
		</if>
	</select>

	<select id="getRegisteredZoneList" parameterType="hashmap" resultType="hashmap">
        select name,code
        from tb_zone
        where code in
        (
        select zone_code
        from tb_sys_units
        where
        stop_date > now()
        and unit_status = 'pass'
        and unit_type = 0
        and zone_code like #{zoneCode,jdbcType=VARCHAR}
        )
    </select>

	<select id="getAllRegisteredZoneList" parameterType="hashmap" resultType="hashmap">
        select name,code
        from tb_zone
        where code in
        (
        select zone_code
        from tb_sys_units
        where
        stop_date > now()
        and unit_status = 'pass'
        and unit_type = 0
        )
    </select>

	<select id="getUnitByZoneCode" parameterType="hashmap" resultMap="sysUnitsMap">
        select *
        from tb_sys_units
        where zone_code = #{zoneCode,jdbcType=VARCHAR}
        and unit_type <![CDATA[<>]]> 1
    </select>

	<select id="getProvincialAgentZoneList" parameterType="hashmap" resultType="hashmap">
        select z.name,z.code
        from tb_sys_units u
        join tb_zone z
        on u.zone_code = z.code
        where u.unit_status = 'pass'
        and u.stop_date > now()
        and u.unit_type = 2
        and parent_id = #{unitId,jdbcType=BIGINT}
        and z.level = 3
    </select>

	<select id="getMunicipalAgentZoneList" parameterType="hashmap" resultType="hashmap">
        select name,code
        from tb_zone
        where pCode = #{zoneCode,jdbcType=VARCHAR}
        and level = 4
    </select>

	<select id="getCountyAgentZoneList" parameterType="hashmap" resultType="hashmap">
        select z.name,z.code
        from tb_sys_units u
        join tb_zone z
        on u.zone_code = z.code
        where u.unit_status = 'pass'
        and u.stop_date > now()
        and u.unit_type = 0
        and u.zone_code like #{zoneCode,jdbcType=VARCHAR}
        and z.level = 5
    </select>

	<select id="getAreaList" parameterType="hashmap" resultType="hashmap">
		select z.name,z.code
		from tb_sys_units u
		join tb_zone z
		on u.zone_code = z.code
		where u.unit_status = 'pass'
		and u.stop_date > now()
		and u.id = #{id,jdbcType=BIGINT}
	</select>
</mapper>